@using NoteTaking.ViewModel;
@model IList<NoteVM>;
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My Notes</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

    <div class="container py-5">
        <h1 class="mb-4 text-center">My Notes</h1>

        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
            @foreach (var note in Model)
            {
                <!-- Note Card 1 -->
                <div class="col">
                    <div class="card h-100 shadow-sm" >
                        <div class="card-body" onclick="GotoEdit(@note.Id)">
                            <h5 class="card-title">@note.Title  </h5>
                            <p class="card-text text-muted">@note.Description</p>
                        </div>
                        <div class="card-footer text-muted small d-flex justify-content-between align-items-center">
                            <span>Created on: @note.CreatedAt</span>
                            <span class="trash-icon" style="cursor: pointer;" onclick="showDeletePopUp(@note.Id)">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-trash3-fill" viewBox="0 0 16 16">
                                    <path d="M11 1.5v1h3.5a.5.5 0 0 1 0 1h-.538l-.853 10.66A2 2 0 0 1 11.115 16h-6.23a2 2 0 0 1-1.994-1.84L2.038 3.5H1.5a.5.5 0 0 1 0-1H5v-1A1.5 1.5 0 0 1 6.5 0h3A1.5 1.5 0 0 1 11 1.5m-5 0v1h4v-1a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5M4.5 5.029l.5 8.5a.5.5 0 1 0 .998-.06l-.5-8.5a.5.5 0 1 0-.998.06m6.53-.528a.5.5 0 0 0-.528.47l-.5 8.5a.5.5 0 0 0 .998.058l.5-8.5a.5.5 0 0 0-.47-.528M8 4.5a.5.5 0 0 0-.5.5v8.5a.5.5 0 0 0 1 0V5a.5.5 0 0 0-.5-.5" />
                                </svg>
                            </span>
                        </div>

                    </div>
                </div>

            }
            <!-- Add more cards as needed -->
            <div class="col">
                <div class="card h-100 shadow-sm" onclick="GotoCreate()">
                    <div class="card-body d-flex justify-content-center align-items-center" style="height: 150px;">
                        <input type="hidden" value="@ViewBag.UserId" id="userId" />
                        <p class="m-0" style="cursor: pointer;" >
                            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" class="bi bi-plus text-muted" viewBox="0 0 16 16">
                                <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4" />
                            </svg>
                        </p>
                    </div>

                </div>
            </div>
            
            <!-- Delete Confirmation Modal -->
            <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="deleteModalLabel">Confirm Deletion</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            Do you want to delete this note?
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-danger" onclick="GotoDelete()">Yes</button>
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function GotoCreate() {
            var id = document.getElementById('userId').value;
            window.location.href = 'https://localhost:7183/Home/Create?userId=' + id;
        }
        function GotoEdit(noteId) {
            var id = document.getElementById('userId').value;
            window.location.href = 'https://localhost:7183/Home/Create?userId=' + id + '&&noteId=' + noteId;
        }

        let currentNoteId = null;

        function showDeletePopUp(noteId) {
            currentNoteId = noteId;
            const deleteModal = new bootstrap.Modal(document.getElementById('deleteModal'));
            deleteModal.show();
        }

        function GotoDelete() {
            if (currentNoteId !== null) {
                window.location.href = `/Home/Delete?id=${currentNoteId}`;
            }
            // // TODO: Delete note logic here (e.g., AJAX)
            // alert("Note " + currentNoteId + " will be deleted.");

            // // Optional: Hide modal manually
            // const deleteModal = bootstrap.Modal.getInstance(document.getElementById('deleteModal'));
            // deleteModal.hide();
        }
    </script>
</body>
</html>
