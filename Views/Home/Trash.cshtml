@using NoteTaking.ViewModel;
@model IList<NoteVM>;
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Trash</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container py-5">
        <h1 class="mb-4 text-center">Everyone’s Notes</h1>

        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
            @foreach (var note in Model)
            {

                var today = DateOnly.FromDateTime(DateTime.Today);
                var permanentDeleteDate = note.DeletedAt?.AddDays(31);

                int daysLeft = permanentDeleteDate.HasValue
                ? permanentDeleteDate.Value.DayNumber - today.DayNumber
                : 0;

                <!-- Note Card 1 -->
                <div class="col">
                    <div class="card h-100 shadow-sm">
                        <div class="card-body">
                            <h5 class="card-title d-flex justify-content-between align-items-center">
                                @note.Title
                                <span class="recycle-icon" title="Restore note" onclick="showRestorePopUp(@note.Id)">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-recycle" viewBox="0 0 16 16">
                                        <path d="M9.302 1.256a1.5 1.5 0 0 0-2.604 0l-1.704 2.98a.5.5 0 0 0 .869.497l1.703-2.981a.5.5 0 0 1 .868 0l2.54 4.444-1.256-.337a.5.5 0 1 0-.26.966l2.415.647a.5.5 0 0 0 .613-.353l.647-2.415a.5.5 0 1 0-.966-.259l-.333 1.242zM2.973 7.773l-1.255.337a.5.5 0 1 1-.26-.966l2.416-.647a.5.5 0 0 1 .612.353l.647 2.415a.5.5 0 0 1-.966.259l-.333-1.242-2.545 4.454a.5.5 0 0 0 .434.748H5a.5.5 0 0 1 0 1H1.723A1.5 1.5 0 0 1 .421 12.24zm10.89 1.463a.5.5 0 1 0-.868.496l1.716 3.004a.5.5 0 0 1-.434.748h-5.57l.647-.646a.5.5 0 1 0-.708-.707l-1.5 1.5a.5.5 0 0 0 0 .707l1.5 1.5a.5.5 0 1 0 .708-.707l-.647-.647h5.57a1.5 1.5 0 0 0 1.302-2.244z" />
                                    </svg>
                                </span>
                            </h5>
                            <p class="card-text text-muted">@note.Description</p>
                        </div>
                        <div class="card-footer text-muted small d-flex justify-content-between align-items-center">
                            <span>Created on: @note.CreatedAt</span>
                            <span>Deleted on: @note.DeletedAt</span>
                            @if (daysLeft > 7)
                            {
                                <span class="text-success fw-semibold">
                                    @daysLeft days left
                                </span>
                            }
                            else if (daysLeft > 0)
                            {
                                <span class="text-warning fw-semibold">
                                    @daysLeft day@(daysLeft > 1 ? "s" : "") left
                                </span>
                            }
                            else
                            {
                                <span class="text-danger fw-semibold">
                                    Ready for permanent deletion
                                </span>
                            }
                        </div>
                    </div>
                </div>
            }
            <!-- Restore Confirmation Modal -->
            <div class="modal fade" id="restoreModal" tabindex="-1" aria-labelledby="restoreModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="restoreModalLabel">Confirm Restoration</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            Do you want to Restore this note?
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-danger" onclick="GotoRestore()">Yes</button>
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let currentNoteId = null;

        function showRestorePopUp(noteId) {
            currentNoteId = noteId;
            const restoreModal = new bootstrap.Modal(document.getElementById('restoreModal'));
            restoreModal.show();
        }

        function GotoRestore() {
            if (currentNoteId !== null) {
                window.location.href = `/Home/Restore?id=${currentNoteId}`;
            }

        }
    </script>
</body>
</html>
